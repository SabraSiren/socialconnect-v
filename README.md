# Social Network App

Социальная сеть с функционалом публикации постов.

 **Рабочая версия приложения доступна по адресу:** https://soc-net.netlify.app/

##  Возможности

- **Аутентификация пользователей** — вход в систему с защищёнными маршрутами
- **Профиль пользователя** — просмотр и управление профилем
- **Публикация постов** — создание и просмотр постов, лайки
- **Изображения в постах** — при создании поста можно прикрепить картинку; изображение отображается в карточке поста под текстом, над блоком лайков и комментариев
- **Аватар профиля** — смена аватара по клику на круг с фото или иконкой; подсказка «Сменить фото» показывается при наведении; загрузка через API с сохранением в профиле
- **Курс валют в реальном времени** — отображение курса USD/RUB через WebSocket
- **Управление состоянием** — Redux Toolkit для централизованного управления состоянием
- **Маршрутизация** — React Router для навигации между страницами

##  Технологии

- **React 19** — библиотека для создания пользовательских интерфейсов
- **TypeScript 5.9** — типизированный JavaScript
- **Vite 6** — сборщик и dev-сервер
- **Redux Toolkit 2.11** — инструментарий для работы с Redux
- **React Router DOM 7** — маршрутизация в React-приложении
- **Axios 1.13** — HTTP-клиент для работы с API
- **Lucide React 0.563** — библиотека иконок
- **Vitest 3** — тестовый фреймворк
- **WebSocket** — для получения данных курса валют в реальном времени

##  Установка и запуск

```bash
npm install
npm run dev
```

Приложение будет доступно по адресу `http://localhost:5173`.

### Переменные окружения

Создайте файл `.env` в корне проекта:

```
VITE_API_URL=https://auth-learn.ru.tuna.am
VITE_WS_URL=wss://auth-learn.ru.tuna.am/ws/usd
```

##  Структура проекта

```
soc-net-app-vite/
├── public/                 # Статические файлы
│   └── vite.svg
├── src/
│   ├── API/                # API-сервисы и WebSocket
│   │   ├── api.ts          # Настройка axios
│   │   ├── AuthService.ts  # Сервис аутентификации (в т.ч. updateProfile для аватара)
│   │   ├── FileService.ts  # Загрузка файлов (посты, аватар)
│   │   ├── PostService.ts  # Сервис для работы с постами
│   │   └── useWebSocket.ts # Хук для WebSocket
│   ├── assets/             # Ассеты (изображения и т.п.)
│   ├── components/         # React-компоненты
│   │   ├── AppRouter.tsx   # Маршрутизация приложения
│   │   ├── Comments/       # Компонент комментариев
│   │   ├── ExchangeRate/   # Компонент курса валют
│   │   ├── LoginPage/      # Страница входа
│   │   ├── Post/           # Компонент поста (текст + изображение по photo_id)
│   │   ├── PostForm/       # Форма создания поста (прикрепление картинки, кнопка с иконкой)
│   │   ├── Posts/          # Список постов
│   │   ├── ProfilePage/    # Страница профиля
│   │   ├── ProtectedRoute.tsx  # Защищённый маршрут
│   │   ├── UI/             # UI-компоненты (Loader и др.)
│   │   └── UserProfile/    # Профиль пользователя (аватар, смена по клику)
│   ├── store/              # Redux store
│   │   ├── hooks.ts        # Типизированные хуки Redux
│   │   ├── index.ts        # Конфигурация store
│   │   └── slices/         # Redux-слайсы
│   │       ├── authSlice.ts    # Слайс аутентификации
│   │       └── postsSlice.ts   # Слайс постов
│   ├── types/              # TypeScript-типы
│   │   ├── axios.d.ts      # Расширение типов axios
│   │   ├── env.d.ts        # Типы переменных окружения
│   │   └── index.ts        # Основные типы
│   ├── utils/              # Утилиты
│   │   ├── errorHandler.ts     # Обработка ошибок
│   │   ├── normalizePost.ts    # Нормализация постов
│   │   └── normalizePost.test.ts # Тесты
│   ├── App.tsx             # Главный компонент
│   ├── App.module.css      # Стили App
│   ├── main.tsx            # Точка входа (Vite)
│   └── globals.css         # Глобальные стили
├── index.html              # HTML-шаблон (Vite)
├── vite.config.ts          # Конфигурация Vite
├── tsconfig.json           # Конфигурация TypeScript
├── tsconfig.app.json
├── tsconfig.node.json
├── eslint.config.js        # Конфигурация ESLint
├── package.json
└── README.md
```

##  Аутентификация

### JWT и Cookies

Приложение использует **JWT (JSON Web Tokens)** для аутентификации пользователей. Токены хранятся в **HTTP-only cookies**, что обеспечивает дополнительную безопасность и защиту от XSS-атак.

#### Особенности реализации

- **Автоматическое управление токенами**: при успешном входе или регистрации сервер автоматически устанавливает JWT-токены в HTTP-only cookies
- **Refresh Token**: при истечении access-токена приложение автоматически обновляет токены через эндпоинт `/auth/refresh`
- **Интерцептор запросов**: Axios перехватывает 401 и автоматически пытается обновить токены перед повторной отправкой запроса
- **Очередь запросов**: во время обновления токенов все запросы ставятся в очередь и выполняются после успешного обновления
- **Безопасное хранение**: токены не хранятся в `localStorage` или `sessionStorage`, управление осуществляется сервером через cookies

#### Процесс аутентификации

1. **Вход/регистрация**: пользователь отправляет credentials на сервер
2. **Установка cookies**: сервер устанавливает access и refresh токены в HTTP-only cookies
3. **Автоматическая отправка**: все последующие запросы автоматически включают cookies благодаря `withCredentials: true`
4. **Обновление токенов**: при получении 401 автоматически вызывается `/auth/refresh`
5. **Выход**: при логауте вызывается `/auth/logout`, который очищает cookies на сервере

### Защищённые маршруты

- `/profile` — страница профиля пользователя
- `/comments/:postId` — страница комментариев к посту

Неавторизованные пользователи перенаправляются на страницу входа.

##  API

Приложение использует REST API для работы с данными.

### Эндпоинты аутентификации

- `POST /auth/login` — вход пользователя
- `POST /auth/register` — регистрация нового пользователя
- `POST /auth/logout` — выход
- `GET /auth/me` — информация о текущем пользователе (включая `avatar_id`)
- `PATCH /auth/me/avatar` — смена аватара (тело: `{ "avatar_id": "<file_id>" }`)
- `POST /auth/refresh` — обновление JWT (вызывается автоматически при 401)

### Файлы и изображения

- `POST /files` — загрузка файла (multipart/form-data); ответ: `{ "file_id": "string | null" }`. Используется для картинок в постах и аватара. Поддерживаются форматы JPG, JPEG, PNG; ограничение размера — 512 KB.
- Изображения отдаются по URL вида `GET /files/<file_id>` (используется в `src` у `<img>`).

### Другие эндпоинты

- Получение и создание постов (при создании поста можно передать `photo_id` в теле запроса)
- Работа с комментариями
- WebSocket для курса валют в реальном времени

**Важно**: все запросы отправляются с `withCredentials: true` для автоматической отправки HTTP-only cookies.

##  Тестирование

Проект использует **Vitest** для тестирования.

```bash
npm run test        # режим watch
npm run test:run    # один прогон
```

Тесты находятся в `src/utils/` (например, `normalizePost.test.ts`).
